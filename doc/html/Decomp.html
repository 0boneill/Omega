<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>PIO User&#39;s Guide: Describing your decompostion to PIO</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Types&nbsp;List</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="Decomp">Describing your decompostion to PIO </a></h1><p>On of the biggest challenges to working with PIO is setting up the call to <a class="el" href="group__PIO__initdecomp.html">PIO_initdecomp</a>. The user must properly describe the how data within each MPI tasks memory should be placed or retrieved from disk. PIO provides several interfaces. We describe the simplest interface first and then progress to the most complex and flexible interface.</p>
<h2><a class="anchor" id="decomp_bc">
Block-cyclic interface</a></h2>
<p>The simplest inteface assumes that your arrays are decomposed in a block-cyclic structure and can be described simply using a start-count type approach. A simple block-cyclic decomposition for a 1-dimension (1D) array is illustrated in Figure 3.1. Note that contigious layout of the data in memory can be easily mapped to a contigious layout on disk. The <em>start</em> arguments corresponds to the starting point of the block of contigious memory, while the <em>count</em> is the number of words. Note that <em>start</em> and <em>count</em> must be arrays of length equal to the dimensionality of the distributed array. While we use a 1D array for simplicity, PIO currently supports up to 5-dimension (5D) arrays. In the case of 5D arrays, the start and count arrays would be of length 5.</p>
<div align="center">
<img src="block-cyclic.png" alt="block-cyclic.png"/>
<p><strong>Figure 3.1: Setting up the <em>start</em> and <em>count</em> arrays for a single 1D array distributed accross 3 MPI tasks.</strong></p></div>
<p>We next provide the call to <a class="el" href="group__PIO__initdecomp.html">PIO_initdecomp</a> that would necessary implement the decomposition illustrated in Figure 1. The variable <em>iosystem</em> is created by the call to <a class="el" href="group__PIO__init.html">PIO_init</a>. The second argument <em>PIO_double</em> is the PIO kind, and indicates that this is a decomposition for a 8-byte real. For a list of supported kinds see <a class="el" href="group__PIO__kinds.html">PIO_kinds</a>. The argument <em>dims</em> is the global dimension for the array. The <em>start</em> and <em>count</em> arrays are 8-byte integers of type PIO_OFFSET, while <em>iodesc</em> is the IO descriptor generated by the call to PIO_initdecomp.</p>
<div class="fragment"><pre class="fragment">
 type (iosystem_desc)t)     :: iosystem
 integer (i4)               :: dims(1) 
 integer (kind=PIO_OFFSET)  :: start(1), count(1)
 type (io_desc_t)           :: iodesc
 ...
 !---------------------------------------
 ! Initializing the decomposition on PE 0
 !---------------------------------------
 dims(1) = 8
 start(1) = 3
 count(1) = 3
 call PIO_initdecomp(iosystem,PIO_double,dims,start,count,iodesc)

</pre></div><h2><a class="anchor" id="rearr">
Controling IO decomposition</a></h2>
<p>The above example represents the simplest way to initialize and use PIO to write out and read distributed arrays. PIO however provides some additnnoal features that allows greater control over the IO process. In particular, it provides the ability to define an IO decomposition. Note that a user defined IO decomposition is optional. If one is not provided and rearrangement is necessary, PIO will internally compute a IO decomposition. We describe the reason a IO decomposition my be necessary in Sectiom <a class="el" href="Decomp.html#decomp_dof">Degree of freedom interface</a>. This flexibility provides the ability define an intermediate decomposition that is unique from the computational decomposition. This IO decomposition could be constructed as to maximize the write or read performance to the disk subsystem. We extend the simple example in Figure 1 to include an IO decomposition in Figure 1b.</p>
<div align="center">
<img src="block-cyclic-rearr.png" alt="block-cyclic-rearr.png"/>
<p><strong>Figure 1b: Block cyclic decomposition with rearrangement</strong></p></div>
<p>In Figure 1b we illustrate the creation of an IO decomposition on two of the MPI tasks. For this decomposition the 8 word array is evenly distributed between PE 0 and PE 2. The arrows in Figure 1b indicates rearrangement that is performed within the PIO library. In this case PE 0 sends an word to PE 2 while PE 1 sends two words to PE 0. The rearranged array in the IO decomposition is subsequently written to disk. Note that in this case, only two of three MPI tasks are performing writes to disk. PIO allows the user to specify the IO decomposition using the optional parameters <em>iostart</em> and <em>iocount</em>. The following bit of code for PE 0 illustrates the necessary call to <a class="el" href="group__PIO__initdecomp.html">PIO_initdecomp</a>.</p>
<div class="fragment"><pre class="fragment">
 type (iosystem_desc)t)     :: iosystem
 integer (i4)               :: dims(1) 
 integer (kind=PIO_OFFSET)  :: compstart(1), compcount(1)
 integer (kind=PIO_OFFSET)  :: iostart(1), iocount(1)
 type (io_desc_t)           :: iodesc
 ...
 !---------------------------------------
 ! Initializing the decomposition on PE 0
 !---------------------------------------
 dims(1) = 8
 compstart(1) = 3
 compcount(1) = 3
 iostart(1) = 1
 iccount(1) = 4
 call PIO_initdecomp(iosystem,PIO_double,dims,compstart,compcount,iodesc,iostart=iostart,iocount=iocount)

</pre></div><h2><a class="anchor" id="decomp_dof">
Degree of freedom interface</a></h2>
<p>The interface described in Section <a class="el" href="Decomp.html#decomp_bc">Block-cyclic interface</a>, while simple and used by both pNetCDF (<a href="http://trac.mcs.anl.gov/projects/parallel-netcdf">http://trac.mcs.anl.gov/projects/parallel-netcdf</a>) and NetCDF-4 (<a href="http://www.unidata.ucar.edu/software/netcdf/">http://www.unidata.ucar.edu/software/netcdf/</a>) is frequencly insufficient for applications with non-trivial decompositions. While it is possible to use use multiple calls to construct a file with a non-trivial decomposition the performance penalty is frequently significant. PIO therefore provides a more general interface to <a class="el" href="group__PIO__initdecomp.html">PIO_initdecomp</a> based on the degree of freedom concept. Each word within the distributed array must be given a unique value that corresponds to its order placement in the file on disk. So the first word in the file on disk has a dof of 1, the second 2, etc. This allows a fully general specification of the decomposition. We illustrate its use Figure 2. Note that in Figure 2, PE 0 and PE 1 do not contain contiguous pieces of the distributed array. The desired order on disk must be specified using the the compDOF argument to <a class="el" href="group__PIO__initdecomp.html">PIO_initdecomp</a>. In this case PE 0 contains the 2nd, 4th, and 5th element of the array, PE 1 contains the 1st and 3rd, and PE 2 contains the 6th, 7th, and 8th elements of the array. The integer compDOF arrays for each MPI task is illustrated at the bottom of Figure 2.</p>
<div align="center">
<img src="dof.png" alt="dof.png"/>
<p><strong>Figure 2: Setting up the comDOF arrays for a single 1D array distributed accross 3 MPI tasks.</strong></p></div>
<p>The call to <a class="el" href="group__PIO__initdecomp.html">PIO_initdecomp</a> which implements Figure 2 on PE 0 is provided below.</p>
<div class="fragment"><pre class="fragment">
 type (iosystem_desc)t)     :: iosystem
 integer (i4)               :: dims(1) 
 integer (i4)               :: compdof
 type (io_desc_t)           :: iodesc
 ...
 !---------------------------------------
 ! Initializing the decomposition on PE 0
 !---------------------------------------
 dims(1) = 8
 compdof = (/2,4,5/)
 call PIO_initdecomp(iosystem,PIO_double,dims,compdof,iodesc)

</pre></div><p>As with the block-cyclic interface the degree of freedom interface provides the ability to specify the io decomposition through optional arguments to <a class="el" href="group__PIO__initdecomp.html">PIO_initdecomp</a>.</p>
<div align="center">
<img src="dof-rearr.png" alt="dof-rearr.png"/>
<p><strong>Figure 3: Setting up the comDOF arrays and setting io decomposition for a single 1D array distributed accross 3 MPI tasks and written from 2 tasks after rearrangement within the PIO library</strong></p></div>
<p>Figure 2 illustrates the inclusion of an io decomposition and associated rearrangement to write out the distributed array. The subroutine call to <a class="el" href="group__PIO__initdecomp.html">PIO_initdecomp</a> is illustrated below:</p>
<div class="fragment"><pre class="fragment">
 type (iosystem_desc)t)     :: iosystem
 integer (i4)               :: dims(1) 
 integer (i4)               :: compdof
 type (io_desc_t)           :: iodesc
 integer (kind=PIO_OFFSET)  :: iostart(:),iocount(:)

 ...
 !---------------------------------------
 ! Initializing the decomposition on PE 0
 !---------------------------------------
 dims(1) = 8
 compdof = (/2,4,5/)
 iostart(1) = 1
 iccount(1) = 4
 call PIO_initdecomp(iosystem,PIO_double,dims,compdof,iodesc,iostart=iostart,iocount=iocount)

</pre></div> </div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on Mon Jan 4 13:14:22 2010 for PIO User's Guide by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
